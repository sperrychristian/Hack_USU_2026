{"name": "master", "commit": {"sha": "724527bc3b660a9d54aab8e4dff50430450f1643", "node_id": "C_kwDOBLBVPdoAKDcyNDUyN2JjM2I2NjBhOWQ1NGFhYjhlNGRmZjUwNDMwNDUwZjE2NDM", "commit": {"author": {"name": "Linus Torvalds", "email": "torvalds@linux-foundation.org", "date": "2022-09-12T20:38:22Z"}, "committer": {"name": "Linus Torvalds", "email": "torvalds@linux-foundation.org", "date": "2022-09-12T20:58:59Z"}, "message": "Fix the dc sensor index fixup\n\nfixup_dc_sample_sensors() would make sure that any pressure sensor\nindexes were in range of the cylinders by just clearing the pressure\ndata if the sensor index was larger than the number of cylinders in the\ndive.\n\nThat certainly makes the sensor index data consistent, but at the cost\nof just dropping the sensor data entirely.\n\nDirk had some cases of odd sensor data (probably because of an older\nversion of subsurface, but possibly due to removing cylinders manually\nor because of oddities with the downloader for the Atomic Aquatics\nCobalt dive computer he used), and when re-saving the dive, the pressure\ndata would magically just get removed due to this.\n\nSo rewrite the sensor data fixup to strive very hard to avoid throwing\npressure sensor data away.\n\nWe do this by:\n\n (a) generating a mask of sensor numbers seen\n\n (b) checking if that mask is a subset of the cylinders we have, in\n     which case everything is fine.\n\n (c) if it's not a subset, \"compress\" the sensor indexes to the minimal\n     range (ie if you had sensor indexes 3 and 6, rename 3 to 0, and 6\n     to 1).\n\n (d) if it now fits in the cylinder mask we have, everything is fine\n\n (e) if we still have more sensors than we have cylinders, leave the\n     data alone, but complain about it with SSRF_INFO() so that the user\n     is notified.\n\nThat final (e) case might be for dive computers that allow reporting\npressure data for your buddy's cylinder too.  So it's odd, but not\nentirely crazy, and we now will keep the data.  You may have to add a\nfake cylinder to your dive to make it all make sense and avoid the\ninformational warning.\n\nThis whole \"we clear the pressure data\" was at least partly hidden by\ntwo things:\n\n (1) in the git save format, we don't rewrite dives unless you've\n     changed the dive some way, so old dives stay around with old data\n     in the save until explicitly changed.\n\n (2) if you had multiple dive computers, and one dive computer does not\n     have any pressure data but another one does, our profile will use\n     that \"other\" dive computer pressure data (because often times you\n     might have only one dive computer that is air integrated, but you\n     still want to see the tank pressure when you look at other dive\n     computers - or you have one dive computer give pressure data for\n     your deco bottle, and another for your travel gas etc).\n\nSo those two facts hid the reality that we had actually cleared the tank\nsensor data for Dirk's dive with the Atomic Aquatics dive computer,\nbecause we'd still see pressure data in the profile, and the git data\nwould still be the old one.\n\nUntil Dirk renumbered his dives, and the data was rewritten.\n\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>", "tree": {"sha": "e71c88e10ab82bca15aa7a820c1d5f1feaeb80fd", "url": "https://api.github.com/repos/torvalds/subsurface-for-dirk/git/trees/e71c88e10ab82bca15aa7a820c1d5f1feaeb80fd"}, "url": "https://api.github.com/repos/torvalds/subsurface-for-dirk/git/commits/724527bc3b660a9d54aab8e4dff50430450f1643", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null, "verified_at": null}}, "url": "https://api.github.com/repos/torvalds/subsurface-for-dirk/commits/724527bc3b660a9d54aab8e4dff50430450f1643", "html_url": "https://github.com/torvalds/subsurface-for-dirk/commit/724527bc3b660a9d54aab8e4dff50430450f1643", "comments_url": "https://api.github.com/repos/torvalds/subsurface-for-dirk/commits/724527bc3b660a9d54aab8e4dff50430450f1643/comments", "author": {"login": "torvalds", "id": 1024025, "node_id": "MDQ6VXNlcjEwMjQwMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1024025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/torvalds", "html_url": "https://github.com/torvalds", "followers_url": "https://api.github.com/users/torvalds/followers", "following_url": "https://api.github.com/users/torvalds/following{/other_user}", "gists_url": "https://api.github.com/users/torvalds/gists{/gist_id}", "starred_url": "https://api.github.com/users/torvalds/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/torvalds/subscriptions", "organizations_url": "https://api.github.com/users/torvalds/orgs", "repos_url": "https://api.github.com/users/torvalds/repos", "events_url": "https://api.github.com/users/torvalds/events{/privacy}", "received_events_url": "https://api.github.com/users/torvalds/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "committer": {"login": "torvalds", "id": 1024025, "node_id": "MDQ6VXNlcjEwMjQwMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/1024025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/torvalds", "html_url": "https://github.com/torvalds", "followers_url": "https://api.github.com/users/torvalds/followers", "following_url": "https://api.github.com/users/torvalds/following{/other_user}", "gists_url": "https://api.github.com/users/torvalds/gists{/gist_id}", "starred_url": "https://api.github.com/users/torvalds/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/torvalds/subscriptions", "organizations_url": "https://api.github.com/users/torvalds/orgs", "repos_url": "https://api.github.com/users/torvalds/repos", "events_url": "https://api.github.com/users/torvalds/events{/privacy}", "received_events_url": "https://api.github.com/users/torvalds/received_events", "type": "User", "user_view_type": "public", "site_admin": false}, "parents": [{"sha": "3446dd512597d538c1c1f337a85225700c965a25", "url": "https://api.github.com/repos/torvalds/subsurface-for-dirk/commits/3446dd512597d538c1c1f337a85225700c965a25", "html_url": "https://github.com/torvalds/subsurface-for-dirk/commit/3446dd512597d538c1c1f337a85225700c965a25"}]}, "_links": {"self": "https://api.github.com/repos/torvalds/subsurface-for-dirk/branches/master", "html": "https://github.com/torvalds/subsurface-for-dirk/tree/master"}, "protected": false, "protection": {"enabled": false, "required_status_checks": {"enforcement_level": "off", "contexts": [], "checks": []}}, "protection_url": "https://api.github.com/repos/torvalds/subsurface-for-dirk/branches/master/protection"}